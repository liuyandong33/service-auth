<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="build.dream.auth.mappers.PrivilegeMapper">
    <select id="obtainUserAppPrivileges" resultType="build.dream.common.domains.saas.AppPrivilege">
        SELECT
        app_privilege.*
        FROM app_privilege
        INNER JOIN tenant_role_app_privilege_r ON app_privilege.id = tenant_role_app_privilege_r.privilege_id
        INNER JOIN tenant_role ON tenant_role.id = tenant_role_app_privilege_r.role_id AND tenant_role.deleted = 0
        INNER JOIN user_tenant_role_r ON tenant_role.id = user_tenant_role_r.role_id AND user_tenant_role_r.user_id = #{userId}
        WHERE app_privilege.deleted = 0
    </select>

    <select id="obtainUserPosPrivileges" resultType="build.dream.common.domains.saas.PosPrivilege">
        SELECT
        pos_privilege.*
        FROM pos_privilege
        INNER JOIN tenant_role_pos_privilege_r ON pos_privilege.id = tenant_role_pos_privilege_r.privilege_id
        INNER JOIN tenant_role ON tenant_role.id = tenant_role_pos_privilege_r.role_id AND tenant_role.deleted = 0
        INNER JOIN user_tenant_role_r ON tenant_role.id = user_tenant_role_r.role_id AND user_tenant_role_r.user_id = #{userId}
        WHERE pos_privilege.deleted = 0
    </select>

    <select id="obtainUserBackgroundPrivileges" resultType="build.dream.common.domains.saas.BackgroundPrivilege">
        SELECT
        background_privilege.*
        FROM background_privilege
        INNER JOIN tenant_role_background_privilege_r ON background_privilege.id = tenant_role_background_privilege_r.privilege_id
        INNER JOIN tenant_role ON tenant_role.id = tenant_role_background_privilege_r.role_id AND tenant_role.deleted = 0
        INNER JOIN user_tenant_role_r ON tenant_role.id = user_tenant_role_r.role_id AND user_tenant_role_r.user_id = #{userId}
        WHERE background_privilege.deleted = 0
    </select>
</mapper>